http:
    port: 5001 # ê²Œì´íŠ¸ì›¨ì´ ì‹¤í–‰ í¬íŠ¸

# admin:
#   port: 9876
#   host: localhost

apiEndpoints:
    authApi:
        host: "*" # ë°°í¬ ì‹œì—ëŠ” íŠ¹ì • í˜¸ìŠ¤íŠ¸ë¡œ ì œí•œí•´ì•¼ í•¨
        paths: "/api/auth/*"
    boardApi:
        host: "*"
        paths: "/api/board/*"

serviceEndpoints:
    authService:
        url: "http://localhost:5002" # AUTH ì„œë¹„ìŠ¤ URL
    boardService:
        url: "http://localhost:5003" # BOARD ì„œë¹„ìŠ¤ URL

policies:
    - cors
    - log
    - proxy
    #   - jwt-policy
    - jwt
    # - basic-auth
    # - expression
    # - key-auth
    # - oauth2
    # - rate-limit

pipelines:
    authPipeline:
        apiEndpoints:
            - authApi
        policies:
            - log:
                  action:
                      message: "Auth request received"
            - cors: # ë§¨ ìœ„ ë°°ì¹˜
                  action:
                      origin: ["http://localhost:5000"]
                      credentials: true
                      methods: "GET, POST, PUT, DELETE, OPTIONS"
                      allowedHeaders: ["Authorization", "Content-type"]
                      exposedHeaders: ["Authorization"]
                      preflightContinue: false
                      optionsSuccessStatus: 204

            - proxy:
                  action:
                      serviceEndpoint: authService
                      changeOrigin: true

    boardPipeline:
        apiEndpoints:
            - boardApi
        policies:
            - cors: # ë§¨ ìœ„ ë°°ì¹˜
                  action:
                      origin: ["http://localhost:5000"]
                      credentials: true
                      methods: "*"
                      allowedHeaders: ["Authorization", "Content-type"]
                      exposedHeaders: ["Authorization"]
                      preflightContinue: false
                      optionSuccessStatus: 204
            - log:
                  action:
                      message: "ğŸ” JWT ê²€ì¦ ì‹œì‘ - Authorization í—¤ë”: ${req.headers.authorization}"
            - jwt:
                  action:
                      secretOrPublicKeyFile: ../keys/public.pem # JWT ê²€ì¦
                      checkCredentialExistence: true
                      allowAuthorizationHeaderPrefix: true # Bearer ì ‘ë‘ì‚¬ í”½ìŠ¤ ì—¬ë¶€
                      #   allowExpiredTokens: false # ë§Œë£Œëœ í† í° í—ˆìš© ì—¬ë¶€
                      #   ignoredMethods: ["OPTIONS"] # OPTIONS Preflight ìš”ì²­ì´ boardServiceë¡œ ì „ë‹¬ë˜ì§€ ì•Šê³ , ê²Œì´íŠ¸ì›¨ì´ì—ì„œ ì§ì ‘ ì‘ë‹µì„ ë°˜í™˜
            - log:
                  action:
                      message: "âœ… JWT ê²€ì¦ ì™„ë£Œ"

            - proxy:
                  action:
                      serviceEndpoint: boardService
                      changeOrigin: true
