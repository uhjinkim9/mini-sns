http:
    port: 5001 # 게이트웨이 실행 포트
# admin:
#   port: 9876
#   host: localhost
apiEndpoints:
    loginApi:
        host: "*"
        paths: "/api/auth/login"
    authApi:
        host: "*"
        paths: "/api/auth/*"
serviceEndpoints:
    loginService:
        url: "http://localhost:5002" # LOGIN 서비스 URL
    authService:
        url: "http://localhost:5002" # AUTH 서비스 URL

policies:
    - cors
    - log
    - jwt
    - proxy
    # - basic-auth
    # - expression
    # - key-auth
    # - oauth2
    # - rate-limit

pipelines:
    loginPipeline:
        apiEndpoints:
            - loginApi
        policies:
            - log:
                  - action:
                        message: "Login request received"
            - cors: # 맨 위 배치
                  - action:
                        origin: "http://localhost:5000"
                        credentials: true
                        methods: "GET, POST, PUT, DELETE, OPTIONS"
                        allowedHeaders:
                            [
                                "Authorization",
                                "Content-type",
                                "Origin",
                                "Access-Control-Allow-Origin",
                                "Access-Control-Allow-Methods",
                                "Accept",
                                "Options",
                                "Access-Control-Request-Headers",
                                "Access-Control-Request-Method",
                            ]
                        exposedHeaders:
                            [
                                "Authorization",
                                "Content-type",
                                "Origin",
                                "Access-Control-Allow-Origin",
                                "Access-Control-Allow-Methods",
                                "Accept",
                                "Options",
                                "Access-Control-Request-Headers",
                                "Access-Control-Request-Method",
                            ]
                        preflightContinue: false
                        optionsSuccessStatus: 204
            - proxy:
                  - action:
                        serviceEndpoint: loginService
                        changeOrigin: true
        
    authPipeline:
        apiEndpoints:
            - authApi
        policies:
            - cors: # 맨 위 배치
                  - action:
                        origin: "http://localhost:5000"
                        credentials: true
                        methods: "GET, POST, PUT, DELETE, OPTIONS"
                        allowedHeaders:
                            [
                                "Authorization",
                                "Content-type",
                                "Origin",
                                "Access-Control-Allow-Origin",
                                "Access-Control-Allow-Methods",
                                "Accept",
                                "Options",
                                "Access-Control-Request-Headers",
                                "Access-Control-Request-Method",
                            ]
                        exposedHeaders:
                            [
                                "Authorization",
                                "Content-type",
                                "Origin",
                                "Access-Control-Allow-Origin",
                                "Access-Control-Allow-Methods",
                                "Accept",
                                "Options",
                                "Access-Control-Request-Headers",
                                "Access-Control-Request-Method",
                            ]
                        preflightContinue: false
                        optionsSuccessStatus: 204
            - jwt:
                  - action:
                        secretOrPublicKeyFile: ../keys/public.pem # JWT 검증
                        allowMissing: true
                        checkCredentialExistence: false
            - proxy:
                  - action:
                        serviceEndpoint: authService
                        changeOrigin: true